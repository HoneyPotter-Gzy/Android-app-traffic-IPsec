# Android-app-traffic-IPSec
辅助于在真机采集IPSec隧道流量并进行包过滤的简易脚本
## 功能说明
- 流量采集辅助脚本(不进行包过滤版本)：辅助进行抓包的开始与结束、包的命名，可保留原始数据包
- 流量采集辅助脚本（进行包过滤版本）：辅助进行抓包的开始与结束、包的命名，并仅捕获指定ip的通信数据包
- 包过滤脚本：通过ip过滤剔除掉PC端产生的杂流对数据集的影响

两个流量采集辅助脚本的区别：前者捕获所有经PC转发的数据包（包括PC本机），后者可按IP仅捕获来自手机端的数据包

## 环境配置
- 流量采集辅助脚本(不进行包过滤版本)：需要下载安装windump并将其添加到环境变量
- 流量采集辅助脚本(进行包过滤版本)：同上
- 包过滤脚本：需要下载安装wireshark的命令行版本tshark并将其添加到环境变量  
也可自行修改cmd命令，使用其他有类似功能的命令行工具，能实现相同的抓包/包过滤功能即可。
- 真机：IPSec的配置方法另附。在采集前，需要在真机中关闭如下服务：**1. 在设置中关闭除目标应用外其他所有应用的联网权限；2. 关闭目标应用中可能出现的视频（如有）在wifi下自动加载的功能**

## 脚本使用
- 流量采集辅助脚本（两版本通用）
流程：
```
# 设定pcap文件保存路径、预期采集的pcap数目pcap_num、应用名appname、行为名operation
# 启动脚本
# 脚本挂起等待，按y确认，windump开始采集
# 在真机上人为执行对应的行为
# 执行完毕后按y确认本次行为结束，windump结束本次采集
```
上述过程循环执行pcap_num次

- 包过滤脚本
流程：
```
# 设定需要过滤的原始包的存储路径
# 设定IPSec隧道所连接的远程vps地址
# 启动脚本
# 等待脚本过滤结束
```

## Tips：
- 流量采集辅助脚本中，windump -i 4中的4表示网卡序号，此处网卡序号会因PC不同而产生变化，可使用windump -D查看网卡名与网卡序号的对应关系，并通过对网卡一一抓包尝试（或其他方法）确认应当监听的网卡序号
- 流量采集辅助脚本中，在控制台确认开始抓包后即开始执行相应的网络行为，尽量避免应用中其他行为所产生的杂流混入
